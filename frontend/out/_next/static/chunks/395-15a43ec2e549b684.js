"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[395],{2281:function(e,t,n){n.d(t,{Z:function(){return o}});var r=n(5893),l=n(7294),i=n(6177),u=n(2490),a=n(6145);function o(e){let{isOpen:t,onClose:n}=e,{setTokenBalance:o,setUserRole:s,resetUserRole:c}=(0,i.mr)(),d=(0,u.Z)(),[f,m]=(0,l.useState)(""),[g,h]=(0,l.useState)(""),[p,b]=(0,l.useState)(!1),[y,v]=(0,l.useState)(null),[x,w]=(0,l.useState)(!1),k=(0,a.Z)(t,n);if(!t)return null;let j=async e=>{e.preventDefault(),w(!0),v(null);try{var t;let e=await d.login({email:f,password:g,remember:p});o(e.balance||0);let r=null==e?void 0:null===(t=e.user)||void 0===t?void 0:t.role;"string"==typeof r&&r.trim()?s(r):c(),null==n||n()}catch(e){v(e.message||"Login failed")}finally{w(!1)}};return(0,r.jsx)("div",{id:"authModal",className:"auth-modal show",role:"dialog","aria-modal":"true","aria-labelledby":"authTitle",ref:k,children:(0,r.jsxs)("div",{className:"auth-card",children:[(0,r.jsx)("h2",{id:"authTitle",children:"Welcome to Invitation Maker"}),(0,r.jsx)("p",{children:"Sign in to save your projects to the cloud, or continue working offline."}),(0,r.jsxs)("form",{id:"loginForm",onSubmit:j,children:[(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{htmlFor:"loginEmail",children:"Email address"}),(0,r.jsx)("input",{type:"email",id:"loginEmail",name:"loginEmail",placeholder:"Email address",required:!0,value:f,onChange:e=>m(e.target.value)})]}),(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{htmlFor:"loginPassword",children:"Password"}),(0,r.jsx)("input",{type:"password",id:"loginPassword",name:"loginPassword",placeholder:"Password",required:!0,value:g,onChange:e=>h(e.target.value)})]}),(0,r.jsxs)("div",{className:"form-group",style:{display:"flex",alignItems:"center",gap:8,marginTop:8},children:[(0,r.jsx)("input",{type:"checkbox",id:"rememberMe",name:"rememberMe",checked:p,onChange:e=>b(e.target.checked)}),(0,r.jsx)("label",{htmlFor:"rememberMe",style:{margin:0},children:"Remember me"})]}),y&&(0,r.jsx)("div",{className:"error",role:"alert",children:y}),(0,r.jsx)("button",{type:"submit",className:"btn primary",style:{width:"100%",margin:"16px 0 8px"},disabled:x,children:x?"Signing inâ€¦":"Sign In"})]}),(0,r.jsx)("p",{style:{marginTop:16,fontSize:12,color:"#94a3b8",textAlign:"center"},children:"Don't have an account? Create one in your backend admin panel."}),(0,r.jsx)("button",{type:"button",className:"iconbtn","aria-label":"Close",onClick:n,style:{position:"absolute",top:8,right:8},children:"\xd7"})]})})}},2490:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(8431);function l(){return(0,r.Eu)()}},3012:function(e,t,n){n.d(t,{Z:function(){return a}});var r=n(7294),l=n(6177),i=n(2490);function u(e){var t,n,r,l,i;if(null==e)return null;if("string"==typeof e||"number"==typeof e)return{id:"string"==typeof e?e:String(e),owned:!0};if("object"!=typeof e)return null;let u=null!==(i=null!==(l=null!==(r=null!==(n=null!==(t=e.id)&&void 0!==t?t:e.designId)&&void 0!==n?n:e.token)&&void 0!==r?r:e.slug)&&void 0!==l?l:e.uuid)&&void 0!==i?i:null;if(null==u)return null;let a="string"==typeof u?u:String(u),o=void 0===e.owned||!!e.owned;return{...e,id:a,owned:o}}function a(){var e,t,n;let{designOwnership:a={},setCurrentDesignId:o,setDesignOwnershipLoading:s,setDesignOwnershipError:c,setDesignOwnershipEntries:d,clearDesignOwnershipEntry:f,resetDesignOwnership:m}=(0,l.mr)(),g=(0,i.Z)(),h=null==g?void 0:g.api,p=null!==(e=a.currentDesignId)&&void 0!==e?e:null,b=null!==(t=a.ownershipByDesignId)&&void 0!==t?t:{},y=!!a.loading,v=null!==(n=a.error)&&void 0!==n?n:null,x=(0,r.useCallback)(e=>{let t=null!=e?e:p;if(null==t)return!1;let n=b["string"==typeof t?t:String(t)];return!!n&&("boolean"==typeof n?n:"boolean"!=typeof n.owned||n.owned)},[p,b]),w=(0,r.useCallback)(e=>{var t;let n=null!=e?e:p;return null==n?null:null!==(t=b["string"==typeof n?n:String(n)])&&void 0!==t?t:null},[p,b]),k=(0,r.useRef)(!1),j=(0,r.useCallback)(async()=>{if(k.current=!0,!h||"function"!=typeof h.getUserDesigns)return d([],{replace:!0}),[];s(!0),c(null);try{var e;let t=((e=await h.getUserDesigns())?Array.isArray(e)?e:Array.isArray(e.designs)?e.designs:Array.isArray(e.items)?e.items:Array.isArray(e.data)?e.data:Array.isArray(e.results)?e.results:[]:[]).map(u).filter(Boolean);return d(t,{replace:!0}),t}catch(e){throw c(e),d([],{replace:!0}),e}finally{s(!1)}},[h,d,c,s]),A=(0,r.useCallback)(async e=>{let t=null!=e?e:p;if(null==t)return!1;if(x(t))return!0;try{return(await j()).some(e=>e.id===("string"==typeof t?t:String(t))&&e.owned)}catch(e){return!1}},[p,x,j]),E=(0,r.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=null!=e?e:p;if(null==n)return null;let r=u({id:"string"==typeof n?n:String(n),owned:!0,...t});return r?(d([r],{replace:!1}),r):null},[p,d]),S=(0,r.useCallback)(e=>{let t=null!=e?e:p;null!=t&&f("string"==typeof t?t:String(t))},[f,p]),C=(0,r.useRef)(!!(null==g?void 0:g.isAuthenticated)),D=(0,r.useCallback)(()=>{k.current=!1;let e=Object.keys(b).length>0,t=null!=p,n=!!v;(e||t||y||n)&&m()},[p,v,y,b,m]);return(0,r.useEffect)(()=>{if(!(null==g?void 0:g.isAuthenticated)){let e=Object.keys(b).length>0,t=!!v;(C.current||e||t||y)&&D(),C.current=!1,k.current=!1;return}C.current=!0,!y&&(Object.keys(b).length>0||k.current||(k.current=!0,j().catch(()=>{})))},[null==g?void 0:g.isAuthenticated,p,v,y,b,j,D]),(0,r.useMemo)(()=>({currentDesignId:p,ownershipByDesignId:b,loading:y,error:v,isDesignOwned:x,getOwnershipEntry:w,setCurrentDesignId:o,refreshOwnership:j,ensureOwnership:A,markDesignOwned:E,clearDesignOwnership:S,resetDesignOwnership:D}),[S,p,v,w,x,y,E,b,j,D,o,A])}},6145:function(e,t,n){n.d(t,{Z:function(){return i}});var r=n(7294);let l=e=>e?Array.from(e.querySelectorAll('a[href], area[href], button:not([disabled]), input:not([disabled]):not([type="hidden"]), select:not([disabled]), textarea:not([disabled]), iframe, object, embed, [contenteditable="true"], [tabindex]:not([tabindex="-1"])')).filter(e=>e instanceof HTMLElement&&!e.hasAttribute("disabled")&&"true"!==e.getAttribute("aria-hidden")&&-1!==e.tabIndex&&!e.hidden):[];function i(e,t){let n=(0,r.useRef)(null),i=(0,r.useRef)(null);return(0,r.useEffect)(()=>{if("undefined"==typeof document)return;if(!e){let e=i.current;e&&"function"==typeof e.focus&&e.focus();return}let r=n.current;if(!r)return;let u=document.activeElement;u instanceof HTMLElement&&u!==document.body?i.current=u:i.current=null;let a=r.hasAttribute("tabindex"),o=r.getAttribute("tabindex");a||r.setAttribute("tabindex","-1");let s=setTimeout(()=>{let e=l(r);e.length>0?e[0].focus():r.focus()},0),c=e=>{if(!n.current)return;if("Escape"===e.key){e.stopPropagation(),e.preventDefault(),null==t||t();return}if("Tab"!==e.key)return;let r=l(n.current);if(0===r.length){e.preventDefault(),n.current.focus();return}let i=r[0],u=r[r.length-1],a=document.activeElement;e.shiftKey?a!==i&&n.current.contains(a)||(e.preventDefault(),u.focus()):a===u&&(e.preventDefault(),i.focus())},d=e=>{if(!n.current||n.current.contains(e.target))return;let t=l(n.current);t.length>0?t[0].focus():n.current.focus()};return document.addEventListener("keydown",c),document.addEventListener("focusin",d),()=>{clearTimeout(s),document.removeEventListener("keydown",c),document.removeEventListener("focusin",d),a?null!==o&&r.setAttribute("tabindex",o):r.removeAttribute("tabindex")}},[e,t]),n}},4197:function(e,t,n){n.d(t,{NP:function(){return i},dU:function(){return u}});let r=new Set(["creator","admin"]);function l(e){return"string"!=typeof e?"":e.trim().toLowerCase()}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"guest";return l(e)||("string"==typeof t&&t.trim()?t.trim().toLowerCase():"guest")}function u(){let{role:e,canEdit:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,u=i(e,n),a="boolean"==typeof t?t:r.has(l(u));return{role:u,canEdit:a}}Array.from(r)}}]);