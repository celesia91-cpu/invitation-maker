(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[281],{3454:function(e,t,r){"use strict";var s,o;e.exports=(null==(s=r.g.process)?void 0:s.env)&&"object"==typeof(null==(o=r.g.process)?void 0:o.env)?r.g.process:r(7663)},2281:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});var s=r(5893),o=r(7294),i=r(6177),n=r(402);function a(e){let{isOpen:t,onClose:r}=e,{setTokenBalance:a}=(0,i.m)(),l=(0,n.Z)(),[c,u]=(0,o.useState)(""),[h,d]=(0,o.useState)(""),[g,f]=(0,o.useState)(!1),[m,y]=(0,o.useState)(null),[p,v]=(0,o.useState)(!1);if(!t)return null;let w=async e=>{e.preventDefault(),v(!0),y(null);try{let e=await l.login({email:c,password:h,remember:g});a(e.balance||0),null==r||r()}catch(e){y(e.message||"Login failed")}finally{v(!1)}};return(0,s.jsx)("div",{id:"authModal",className:"auth-modal show",role:"dialog","aria-modal":"true","aria-labelledby":"authTitle",children:(0,s.jsxs)("div",{className:"auth-card",children:[(0,s.jsx)("h2",{id:"authTitle",children:"Welcome to Invitation Maker"}),(0,s.jsx)("p",{children:"Sign in to save your projects to the cloud, or continue working offline."}),(0,s.jsxs)("form",{id:"loginForm",onSubmit:w,children:[(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{htmlFor:"loginEmail",children:"Email address"}),(0,s.jsx)("input",{type:"email",id:"loginEmail",name:"loginEmail",placeholder:"Email address",required:!0,value:c,onChange:e=>u(e.target.value)})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{htmlFor:"loginPassword",children:"Password"}),(0,s.jsx)("input",{type:"password",id:"loginPassword",name:"loginPassword",placeholder:"Password",required:!0,value:h,onChange:e=>d(e.target.value)})]}),(0,s.jsxs)("div",{className:"form-group",style:{display:"flex",alignItems:"center",gap:8,marginTop:8},children:[(0,s.jsx)("input",{type:"checkbox",id:"rememberMe",name:"rememberMe",checked:g,onChange:e=>f(e.target.checked)}),(0,s.jsx)("label",{htmlFor:"rememberMe",style:{margin:0},children:"Remember me"})]}),m&&(0,s.jsx)("div",{className:"error",role:"alert",children:m}),(0,s.jsx)("button",{type:"submit",className:"btn primary",style:{width:"100%",margin:"16px 0 8px"},disabled:p,children:p?"Signing inâ€¦":"Sign In"})]}),(0,s.jsx)("p",{style:{marginTop:16,fontSize:12,color:"#94a3b8",textAlign:"center"},children:"Don't have an account? Create one in your backend admin panel."}),(0,s.jsx)("button",{type:"button",className:"iconbtn","aria-label":"Close",onClick:r,style:{position:"absolute",top:8,right:8},children:"\xd7"})]})})}},402:function(e,t,r){"use strict";r.d(t,{Z:function(){return u}});var s=r(7294);let o=[];function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"error",s=arguments.length>3?arguments[3]:void 0;return{level:r,message:e&&e.message?e.message:String(e),stack:e&&e.stack?e.stack:void 0,context:t,details:s,timestamp:new Date().toISOString()}}function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0,s=i(e instanceof Error?e:Error(String(e)),t,"error",r);return o.push(s),console.error("[".concat(s.timestamp,"]").concat(t?" "+t+":":""," ").concat(s.message)),s}function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0,s=i(e instanceof Error?e:Error(String(e)),t,"warn",r);return o.push(s),console.warn("[".concat(s.timestamp,"]").concat(t?" "+t+":":""," ").concat(s.message)),s}var l=r(3454);class c{setupInterceptors(){"function"==typeof window.fetch?(this._originalFetch=window.fetch,this._log("API Client initialized with base URL:",this.baseURL)):(this._originalFetch=this.fetch,this._log("API Client initialized without browser environment:",this.baseURL))}_safeParse(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if("string"!=typeof e)return a("".concat(t,": expected string but received ").concat(typeof e)),r;try{return JSON.parse(e)}catch(o){let s=e.slice(0,100);return a(o,"Failed to parse ".concat(t),{snippet:s}),r}}_getSession(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._storage;try{if(!e||"function"!=typeof e.getItem)return null;let t=e.getItem(this._storageKey);if(!t)return null;if("string"!=typeof t||!t.trim().startsWith("{"))return a("Malformed session storage data"),null;let r=this._safeParse(t,"session storage");return r&&"object"==typeof r?r:null}catch(e){return a(e,"Failed to access session storage"),null}}loadToken(){try{let e=this._loadFromStorage("undefined"!=typeof localStorage?localStorage:null,this._persistentDuration);if(e)return this._storage=localStorage,this._currentDuration=this._persistentDuration,this.token=e.token,this._log("Token restored from localStorage"),e.token;let t=this._loadFromStorage("undefined"!=typeof sessionStorage?sessionStorage:null,this._sessionDuration);if(t)return this._storage=sessionStorage,this._currentDuration=this._sessionDuration,this.token=t.token,this._log("Token restored from sessionStorage"),t.token;return this.token=null,this._storage="undefined"!=typeof sessionStorage?sessionStorage:null,this._currentDuration=this._sessionDuration,null}catch(e){return a(e,"Failed to load token from storage"),null}}_loadFromStorage(e,t){if(!e)return null;let r=this._getSession(e);if(r&&"string"==typeof r.token&&"number"==typeof r.lastActivity){if(Date.now()-r.lastActivity<t)return r;try{e.removeItem(this._storageKey)}catch(e){}}return null}_selectStorage(e){e&&"undefined"!=typeof localStorage?(this._storage=localStorage,this._currentDuration=this._persistentDuration):(this._storage="undefined"!=typeof sessionStorage?sessionStorage:null,this._currentDuration=this._sessionDuration)}saveToken(e){try{if(e&&"string"==typeof e&&this._storage){let t={token:e,lastActivity:Date.now()};this._storage.setItem(this._storageKey,JSON.stringify(t));let r=this._storage===localStorage?sessionStorage:localStorage;try{r&&r.removeItem(this._storageKey)}catch(e){}this.token=e,this._log("Token saved to storage successfully")}else this.clearToken()}catch(t){a(t,"Failed to save token to storage"),this.token=e}}clearToken(){try{"undefined"!=typeof sessionStorage&&sessionStorage.removeItem(this._storageKey)}catch(e){a(e,"Failed to clear token from sessionStorage")}try{"undefined"!=typeof localStorage&&localStorage.removeItem(this._storageKey)}catch(e){a(e,"Failed to clear token from localStorage")}this.token=null,this._storage="undefined"!=typeof sessionStorage?sessionStorage:null,this._currentDuration=this._sessionDuration}saveUser(e){try{if(e&&"object"==typeof e&&this._storage){let t=this._getSession()||{};t.user=e,t.lastActivity=Date.now(),this._storage.setItem(this._storageKey,JSON.stringify(t))}}catch(e){a(e,"Failed to save user to storage")}}getUser(){try{let e=this._getSession();if(e&&"object"==typeof e.user)return e.user;return e&&a("Session user missing or invalid"),null}catch(e){return a(e,"Failed to get user from storage"),null}}isSessionValid(){try{let e=this._getSession();if(!e||"string"!=typeof e.token||"number"!=typeof e.lastActivity)return e&&a("Session missing required fields"),!1;return Date.now()-e.lastActivity<this._currentDuration}catch(e){return!1}}refreshSession(){try{if(!this.token||!this.isSessionValid()||!this._storage)return;let e=this._getSession();e?(e.lastActivity=Date.now(),this._storage.setItem(this._storageKey,JSON.stringify(e))):a("No valid session to refresh")}catch(e){a(e,"Failed to refresh session")}}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.retryRequest(async()=>{let r="".concat(this.baseURL).concat(e);this.refreshSession();let s={...t.headers||{}},o=Object.keys(s).some(e=>"content-type"===e.toLowerCase()),i="undefined"!=typeof FormData&&t.body instanceof FormData;o||i||(s["Content-Type"]="application/json");let n={headers:s,...t};this.token&&this.isSessionValid()&&!Object.keys(s).some(e=>"authorization"===e.toLowerCase())&&(s.Authorization="Bearer ".concat(this.token)),this._log("Making request:",n.method||"GET",r);try{let t;let s=await this.fetch(r,n);if((s.headers.get("content-type")||"").includes("application/json"))try{t=await s.json()}catch(e){a(e,"Failed to parse JSON response"),t={error:"Invalid server response"}}else t=await s.text();if(!s.ok){if(this._log("Request failed:",s.status,t),401===s.status&&!this.isRetrying&&(this.clearToken(),!e.includes("/auth/")))throw Error("Authentication required - please log in again");if(429===s.status)throw Error("Too many requests - please wait a moment");if(s.status>=500)throw Error("Server error - please try again later");let r="object"==typeof t?t.error:t;throw Error(r||"HTTP ".concat(s.status,": ").concat(s.statusText))}return this._log("Request successful:",t),t}catch(e){if("TypeError"===e.name&&e.message.includes("fetch"))throw Error("Network error - please check your connection");throw e}})}async get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new URLSearchParams(t).toString(),s=r?"".concat(e,"?").concat(r):e;return this.request(s,{method:"GET"})}async post(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request(e,{method:"POST",body:JSON.stringify(t),...r})}async put(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request(e,{method:"PUT",body:JSON.stringify(t)})}async delete(e){return this.request(e,{method:"DELETE"})}async getUserTokens(){return this.get("/user/tokens")}async updateTokens(e){return this.post("/purchase",{tokens:e})}async register(e){this.isRetrying=!0;try{let t=await this.post("/auth/register",e);return t.token&&this.saveToken(t.token),t.user&&this.saveUser(t.user),t}finally{this.isRetrying=!1}}async login(e){let{remember:t=!1,...r}=e;try{let e=await this.request("/auth/login",{method:"POST",body:JSON.stringify(r)});if(e.access_token||e.token){let r=e.access_token||e.token;return this._selectStorage(t),this.saveToken(r),e.user&&this.saveUser(e.user),e}throw Error("No token received from server")}catch(e){throw n(e,"Login failed"),e}}async logout(){try{if(this.isAuthenticated())try{await this.request("/auth/logout",{method:"POST"})}catch(e){a(e,"Logout endpoint failed")}}finally{this.clearToken()}}async getCurrentUser(){let e=this.getUser();if(e&&this.isSessionValid())return{user:e};let t=await this.get("/auth/me");return t.user&&this.saveUser(t.user),t}async getUserDesigns(){return this.get("/designs")}async getProjects(){return this.get("/projects")}async getProject(e){return this.get("/projects/".concat(e))}async saveProject(e){return this.post("/projects",e)}async updateProject(e,t){return this.put("/projects/".concat(e),t)}async deleteProject(e){return this.delete("/projects/".concat(e))}async uploadImage(e){if(!e)throw Error("No file provided");if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(e.type))throw Error("Invalid file type. Please upload JPEG, PNG, GIF, or WebP images.");if(e.size>10485760)throw Error("File is too large. Maximum size is 10MB.");if(!this.token||!this.isSessionValid())throw Error("Authentication required for image upload");let t=new FormData;t.append("image",e);try{return await this.request("/images/upload",{method:"POST",body:t})}catch(e){throw Error("Image upload failed: ".concat(e.message))}}async loadCustomerDesign(e){return this.get("/editor/".concat(e))}async saveCustomerDesign(e,t){return this.post("/editor/".concat(e,"/save"),t)}async getCustomerRSVPs(e){return this.get("/editor/".concat(e,"/rsvps"))}async submitRSVP(e){return this.post("/rsvp/submit",e)}isAuthenticated(){return!!(this.token&&this.isSessionValid())}handleError(e){n(e,"API Error");let t=e.message||"An unexpected error occurred.";return t.includes("Network error")?"Connection failed. Please check your internet connection.":t.includes("Authentication required")?"Please log in to continue.":t.includes("Invalid credentials")?"Invalid email or password.":t.includes("User already exists")?"An account with this email already exists.":t.includes("Too many requests")?"Too many requests. Please wait a moment before trying again.":t.includes("File is too large")?"File is too large. Maximum size is 10MB.":t.includes("Invalid file type")?"Please upload a valid image file (JPEG, PNG, GIF, or WebP).":t.includes("Server error")?"Server temporarily unavailable. Please try again later.":t}async retryRequest(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;for(let o=0;o<r;o++)try{return await e()}catch(i){t=i;let e=i.message||"";if(e.includes("Authentication")||e.includes("Invalid")||e.includes("Too many requests")||e.includes("unauthorized"))throw i;if(o<r-1){let e=s*Math.pow(2,o);await new Promise(t=>setTimeout(t,e))}}throw t}async uploadImages(e){let t=Array.from(e).map(e=>this.uploadImage(e));try{return await Promise.all(t)}catch(e){throw Error("Failed to upload images: ".concat(e.message))}}setBaseURL(e){this.baseURL=e,this._log("Base URL updated to:",e)}getBaseURL(){return this.baseURL}async healthCheck(){let e=new AbortController,t=setTimeout(()=>e.abort(),5e3);try{let r=await this.request("/health",{signal:e.signal});return clearTimeout(t),r}catch(e){if(clearTimeout(t),"AbortError"===e.name)throw Error("Health check timed out");throw Error("Backend server is not responding")}}debug(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];this._debug=e,e&&(console.log("API Client Debug Mode Enabled"),console.log("Base URL:",this.baseURL),console.log("Token:",this.token?"Present":"Not set"),console.log("Session Valid:",this.isSessionValid()))}_log(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];this._debug&&console.log("[API Client]",...t)}constructor(e,t){let r=void 0!==l&&l.env&&l.env.NEXT_PUBLIC_API_BASE_URL?l.env.NEXT_PUBLIC_API_BASE_URL:null;if(!e){if(r)e=r;else{let t=window.location.hostname;e="localhost"===t||"127.0.0.1"===t?"http://localhost:3001/api":"https://invitation-maker-api.celesia91.workers.dev/api"}}"function"==typeof window.fetch?this.fetch=window.fetch.bind(window):this.fetch=t||("undefined"!=typeof globalThis&&"function"==typeof globalThis.fetch?globalThis.fetch.bind(globalThis):void 0),this.baseURL=e,this._storageKey="app_auth_session",this._sessionDuration=864e5,this._persistentDuration=6048e5,this._storage="undefined"!=typeof sessionStorage?sessionStorage:null,this._currentDuration=this._sessionDuration,this.token=this.loadToken(),this.setupInterceptors(),this.isRetrying=!1,this._debug=!1}}function u(){let e=(0,s.useMemo)(()=>new c,[]),[t,r]=(0,s.useState)(null),[o,i]=(0,s.useState)(!1),[n,a]=(0,s.useState)(null);(0,s.useEffect)(()=>{try{if(e.isAuthenticated()){let t=e.getUser();t&&r(t)}}catch(e){}},[e]);let l=(0,s.useCallback)(async t=>{let{email:s,password:o,remember:n=!1}=t;i(!0),a(null);try{let t=await e.login({email:s,password:o,remember:n});return(null==t?void 0:t.user)&&r(t.user),t}catch(e){throw a(e),e}finally{i(!1)}},[e]),u=(0,s.useCallback)(async()=>{i(!0),a(null);try{await e.logout(),r(null)}catch(e){a(e),r(null)}finally{i(!1)}},[e]),h=(0,s.useCallback)(async()=>{i(!0),a(null);try{var t;let s=await e.getCurrentUser();return(null==s?void 0:s.user)&&r(s.user),null!==(t=null==s?void 0:s.user)&&void 0!==t?t:null}catch(e){return a(e),null}finally{i(!1)}},[e]);return{user:t,loading:o,error:n,isAuthenticated:e.isAuthenticated(),login:l,logout:u,refreshUser:h,api:e}}new c},7663:function(e){!function(){var t={229:function(e){var t,r,s,o=e.exports={};function i(){throw Error("setTimeout has not been defined")}function n(){throw Error("clearTimeout has not been defined")}function a(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{r="function"==typeof clearTimeout?clearTimeout:n}catch(e){r=n}}();var l=[],c=!1,u=-1;function h(){c&&s&&(c=!1,s.length?l=s.concat(l):u=-1,l.length&&d())}function d(){if(!c){var e=a(h);c=!0;for(var t=l.length;t;){for(s=l,l=[];++u<t;)s&&s[u].run();u=-1,t=l.length}s=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===n||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function f(){}o.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new g(e,t)),1!==l.length||c||a(d)},g.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=f,o.addListener=f,o.once=f,o.off=f,o.removeListener=f,o.removeAllListeners=f,o.emit=f,o.prependListener=f,o.prependOnceListener=f,o.listeners=function(e){return[]},o.binding=function(e){throw Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw Error("process.chdir is not supported")},o.umask=function(){return 0}}},r={};function s(e){var o=r[e];if(void 0!==o)return o.exports;var i=r[e]={exports:{}},n=!0;try{t[e](i,i.exports,s),n=!1}finally{n&&delete r[e]}return i.exports}s.ab="//";var o=s(229);e.exports=o}()}}]);