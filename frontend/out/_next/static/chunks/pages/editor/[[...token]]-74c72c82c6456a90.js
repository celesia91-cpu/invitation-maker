(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[348],{4774:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/editor/[[...token]]",function(){return n(958)}])},958:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return T}});var l=n(5893),i=n(1163),s=n(7294),r=n(2281);let d=(0,s.createContext)(null),o=(0,s.createContext)(null),a={slides:[{id:"slide_".concat(Date.now()),name:"Slide 1",elements:[]}],selected:{slideId:null,elementId:null},viewport:{width:1080,height:1920,scale:1},ui:{showGrid:!1,snapToGrid:!0,showAuthModal:!1,showShareModal:!1}};function c(e,t){var n;let{slideId:l}=e.selected,i=null!=l?l:null===(n=e.slides[0])||void 0===n?void 0:n.id;if(!i)return e;let s=e.slides.map(e=>e.id===i?t(e):e);return{...e,slides:s}}function u(e,t){var n,l,i,s,r,d,o,a,u,h,f,p,x;switch(t.type){case"ADD_SLIDE":{let t=e.slides.length+1,n={id:"slide_".concat(Date.now()),name:"Slide ".concat(t),elements:[]};return{...e,slides:[...e.slides,n],selected:{slideId:n.id,elementId:null}}}case"RENAME_SLIDE":{let{slideId:n,name:l}=t,i=e.slides.map(e=>e.id===n?{...e,name:l}:e);return{...e,slides:i}}case"REMOVE_SLIDE":{let{slideId:i}=t,s=e.slides.filter(e=>e.id!==i),r=null!==(l=null===(n=s[0])||void 0===n?void 0:n.id)&&void 0!==l?l:null;return{...e,slides:s,selected:{slideId:r,elementId:null}}}case"SELECT_SLIDE":return{...e,selected:{slideId:t.slideId,elementId:null}};case"ADD_TEXT":{let n={id:"el_".concat(Date.now()),type:"text",x:null!==(i=t.x)&&void 0!==i?i:100,y:null!==(s=t.y)&&void 0!==s?s:100,width:null!==(r=t.width)&&void 0!==r?r:400,height:null!==(d=t.height)&&void 0!==d?d:80,rotation:0,content:null!==(o=t.content)&&void 0!==o?o:"Edit me",style:{color:"#111",fontFamily:"Arial, sans-serif",fontSize:48,fontWeight:600,textAlign:"center"}};return c(e,e=>({...e,elements:[...e.elements,n]}))}case"UPDATE_TEXT":{let{elementId:n,patch:l}=t;return c(e,e=>({...e,elements:e.elements.map(e=>e.id===n?{...e,...l,style:{...e.style,...l.style||{}}}:e)}))}case"ADD_IMAGE":{let n={id:"el_".concat(Date.now()),type:"image",x:null!==(a=t.x)&&void 0!==a?a:100,y:null!==(u=t.y)&&void 0!==u?u:100,width:null!==(h=t.width)&&void 0!==h?h:400,height:null!==(f=t.height)&&void 0!==f?f:300,rotation:0,src:null!==(p=t.src)&&void 0!==p?p:"",fit:null!==(x=t.fit)&&void 0!==x?x:"cover"};return c(e,e=>({...e,elements:[...e.elements,n]}))}case"UPDATE_IMAGE":{let{elementId:n,patch:l}=t;return c(e,e=>({...e,elements:e.elements.map(e=>e.id===n?{...e,...l}:e)}))}case"SELECT_ELEMENT":return{...e,selected:{...e.selected,elementId:t.elementId}};case"MOVE_ELEMENT":{let{elementId:n,x:l,y:i}=t;return c(e,e=>({...e,elements:e.elements.map(e=>e.id===n?{...e,x:l,y:i}:e)}))}case"RESIZE_ELEMENT":{let{elementId:n,width:l,height:i}=t;return c(e,e=>({...e,elements:e.elements.map(e=>e.id===n?{...e,width:l,height:i}:e)}))}case"DELETE_ELEMENT":{let{elementId:n}=t;return c(e,e=>({...e,elements:e.elements.filter(e=>e.id!==n)}))}case"SET_VIEWPORT":{let{width:n,height:l,scale:i}=t;return{...e,viewport:{width:n,height:l,scale:null!=i?i:e.viewport.scale}}}case"SET_SCALE":return{...e,viewport:{...e.viewport,scale:t.scale}};case"TOGGLE_MODAL":{let{key:n,value:l}=t;return{...e,ui:{...e.ui,[n]:null!=l?l:!e.ui[n]}}}default:return e}}function h(e){let{children:t,initial:n}=e,[i,r]=(0,s.useReducer)(u,n?{...a,...n}:a),c=(0,s.useMemo)(()=>i,[i]),h=(0,s.useMemo)(()=>r,[r]);return(0,l.jsx)(d.Provider,{value:c,children:(0,l.jsx)(o.Provider,{value:h,children:t})})}function f(){let e=(0,s.useContext)(d);if(!e)throw Error("useEditorState must be used within EditorProvider");return e}function p(){let[e,t]=[f(),function(){let e=(0,s.useContext)(o);if(!e)throw Error("useEditorDispatch must be used within EditorProvider");return e}()],{slides:n,selected:i}=e,r=(0,s.useCallback)(()=>{t({type:"ADD_SLIDE"})},[t]),d=(0,s.useCallback)(e=>{t({type:"SELECT_SLIDE",slideId:e})},[t]);return(0,l.jsxs)("div",{style:{width:240,borderRight:"1px solid #e5e7eb",display:"flex",flexDirection:"column"},children:[(0,l.jsxs)("div",{style:{padding:12,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,l.jsx)("strong",{children:"Slides"}),(0,l.jsx)("button",{onClick:r,style:{padding:"4px 8px"},children:"+ Add"})]}),(0,l.jsx)("div",{style:{overflowY:"auto"},children:n.map(e=>(0,l.jsx)("button",{onClick:()=>d(e.id),style:{width:"100%",textAlign:"left",padding:10,border:"none",borderTop:"1px solid #f3f4f6",background:i.slideId===e.id?"#eef2ff":"white",cursor:"pointer"},children:e.name},e.id))})]})}function x(e,t){switch(t.type){case"SET":if(e.present===t.newPresent)return e;return{past:[...e.past,e.present],present:t.newPresent,future:[]};case"UNDO":{if(0===e.past.length)return e;let t=e.past[e.past.length-1];return{past:e.past.slice(0,-1),present:t,future:[e.present,...e.future]}}case"REDO":{if(0===e.future.length)return e;let[t,...n]=e.future;return{past:[...e.past,e.present],present:t,future:n}}default:return e}}function m(e){let[t,n]=(0,s.useReducer)(x,{past:[],present:e,future:[]});return{state:t.present,set:e=>n({type:"SET",newPresent:e}),undo:()=>n({type:"UNDO"}),redo:()=>n({type:"REDO"}),canUndo:t.past.length>0,canRedo:t.future.length>0}}function v(){let e=(0,s.useRef)(!1),t=(0,s.useRef)({x:0,y:0}),{state:n,set:i,undo:r,redo:d,canUndo:o,canRedo:a}=m({x:0,y:0});return(0,l.jsxs)("div",{className:"drag-demo",children:[(0,l.jsx)("div",{className:"draggable",onPointerDown:l=>{e.current=!0,t.current={x:l.clientX-n.x,y:l.clientY-n.y}},onPointerMove:n=>{e.current&&i({x:n.clientX-t.current.x,y:n.clientY-t.current.y})},onPointerUp:()=>{e.current=!1},style:{width:100,height:100,background:"lightblue",position:"absolute",cursor:"move",transform:"translate(".concat(n.x,"px, ").concat(n.y,"px)")}}),(0,l.jsxs)("div",{className:"controls",children:[(0,l.jsx)("button",{onClick:r,disabled:!o,children:"Undo"}),(0,l.jsx)("button",{onClick:d,disabled:!a,children:"Redo"})]})]})}function y(e){let{title:t,children:n}=e,{state:i,set:s,undo:r,redo:d,canUndo:o,canRedo:a}=m(!0);return(0,l.jsxs)("div",{className:"collapsible-group",children:[(0,l.jsxs)("button",{onClick:()=>s(!i),children:[i?"Hide":"Show"," ",t]}),i&&(0,l.jsx)("div",{className:"content",children:n}),(0,l.jsxs)("div",{className:"controls",children:[(0,l.jsx)("button",{onClick:r,disabled:!o,children:"Undo"}),(0,l.jsx)("button",{onClick:d,disabled:!a,children:"Redo"})]})]})}var E=n(6177);function g(){let{imgState:e,workSize:t}=(0,E.m)(),n=(0,s.useMemo)(()=>{var t,n;let l=(e.flip?-1:1)*(null!==(t=e.signX)&&void 0!==t?t:1),i=null!==(n=e.signY)&&void 0!==n?n:1;return["translate(-50%,-50%)","rotate(".concat(e.angle,"rad)"),"skew(".concat(e.shearX,"rad, ").concat(e.shearY,"rad)"),"scale(".concat(e.scale*l,", ").concat(e.scale*i,")")].join(" ")},[e]);return(0,l.jsx)("div",{id:"work",style:{position:"relative",width:t.w,height:t.h,background:"#0b0b22",borderRadius:8,overflow:"hidden"},children:(0,l.jsx)("div",{id:"userBgWrap",style:{position:"absolute",left:e.cx,top:e.cy,width:e.natW,height:e.natH,transform:n,transformOrigin:"50% 50%"},children:e.has?(0,l.jsx)("img",{id:"userBg",src:e.backendImageUrl||e.backendThumbnailUrl||void 0,alt:"Background",style:{display:"block",width:"100%",height:"100%",objectFit:"contain"}}):(0,l.jsx)("div",{style:{color:"#94a3b8",fontSize:12,padding:8},children:"No image selected"})})})}function j(){var e,t;let{activeIndex:n,slides:i,addTextLayer:s,updateTextLayer:r,removeTextLayer:d}=(0,E.m)(),o=null!==(t=null===(e=i[n])||void 0===e?void 0:e.layers)&&void 0!==t?t:[];return(0,l.jsxs)("div",{className:"text-controls",children:[(0,l.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,l.jsx)("input",{id:"addText",type:"text",placeholder:"Type text"}),(0,l.jsx)("button",{className:"btn",onClick:()=>{let e=document.getElementById("addText");s((null==e?void 0:e.value)||"Text"),e&&(e.value="")},children:"+ Add"})]}),(0,l.jsx)("div",{style:{marginTop:12},children:o.map((e,t)=>(0,l.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:6},children:[(0,l.jsxs)("span",{style:{minWidth:80,fontSize:12,color:"#94a3b8"},children:["Layer ",t+1]}),(0,l.jsx)("input",{type:"text",value:e.text,onChange:e=>r(t,{text:e.target.value}),style:{flex:1}}),(0,l.jsx)("button",{className:"btn",onClick:()=>d(t),children:"Delete"})]},t))})]})}function w(){let{playing:e,setPlaying:t}=(0,E.m)();return(0,l.jsxs)("div",{className:"playback-controls",style:{display:"flex",gap:8},children:[(0,l.jsx)("button",{className:"btn",onClick:()=>t(!1),children:"Prev"}),(0,l.jsx)("button",{className:"btn","aria-pressed":e,onClick:()=>t(!e),children:e?"Pause":"Play"}),(0,l.jsx)("button",{className:"btn",onClick:()=>t(!1),children:"Next"})]})}function b(){let e=(0,i.useRouter)(),t=e.query.token,n=e.query.view,{slides:d,setSlides:o,activeIndex:a,setActiveIndex:c,selectedSlide:u,setSelectedSlide:h,tokenBalance:x}=(0,E.m)();f();let[m,b]=(0,s.useState)(!1);return!function(){let{workSize:e,setWorkSize:t}=(0,E.m)();(0,s.useEffect)(()=>{let e=()=>{let e=Math.max(320,Math.min(window.innerWidth-32,1280));t(e,Math.round(e/16*9))};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[t])}(),(0,s.useEffect)(()=>{d&&0!==d.length||(o([{id:1,image:null,layers:[{text:"First Slide",left:16,top:16,fontSize:28,fontFamily:"system-ui",color:"#ffffff"}],workSize:{w:800,h:450},durationMs:3e3},{id:2,image:null,layers:[{text:"Second Slide",left:16,top:16,fontSize:28,fontFamily:"system-ui",color:"#ffffff"}],workSize:{w:800,h:450},durationMs:3e3}]),c(0),h(0))},[d,o,c,h]),(0,s.useEffect)(()=>{u!==a&&c(u)},[u,a,c]),(0,s.useEffect)(()=>{a!==u&&h(a)},[a,u,h]),(0,l.jsxs)("div",{children:["Editor",t&&(0,l.jsxs)("span",{children:[" Token: ",t]}),n&&(0,l.jsxs)("span",{children:[" View: ",n]}),(0,l.jsxs)("div",{children:["Token Balance: ",x]}),(0,l.jsx)("button",{onClick:()=>b(!0),children:"Login"}),(0,l.jsx)(r.Z,{isOpen:m,onClose:()=>b(!1)}),(0,l.jsx)(y,{title:"Slides",children:(0,l.jsx)(p,{slides:d})}),(0,l.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 320px",gap:16,marginTop:16},children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(g,{}),(0,l.jsx)("div",{style:{marginTop:8},children:(0,l.jsx)(w,{})})]}),(0,l.jsx)("div",{children:(0,l.jsx)(j,{})})]}),(0,l.jsx)("div",{style:{marginTop:16},children:(0,l.jsx)(v,{})})]})}function T(){return(0,l.jsx)(h,{children:(0,l.jsx)(b,{})})}},1163:function(e,t,n){e.exports=n(3079)}},function(e){e.O(0,[281,888,774,179],function(){return e(e.s=4774)}),_N_E=e.O()}]);