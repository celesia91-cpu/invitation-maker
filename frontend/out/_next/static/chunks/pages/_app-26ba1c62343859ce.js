(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[888],{3454:function(e,t,r){"use strict";var n,s;e.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(s=r.g.process)?void 0:s.env)?r.g.process:r(7663)},3837:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/_app",function(){return r(3414)}])},6177:function(e,t,r){"use strict";r.d(t,{WE:function(){return c},mr:function(){return d},qD:function(){return a}});var n=r(5893),s=r(7294);let i=(0,s.createContext)(null),o={slides:[],activeIndex:0,playing:!1,userRole:"guest",designOwnership:{currentDesignId:null,ownershipByDesignId:{},loading:!1,error:null},imgState:{has:!1,natW:0,natH:0,cx:0,cy:0,scale:1,angle:0,shearX:0,shearY:0,signX:1,signY:1,flip:!1,backendImageId:null,backendImageUrl:null,backendThumbnailUrl:null},fileUpload:{status:"idle",progress:0,error:null,lastUpload:null,fileName:null},workSize:{w:800,h:450},tokenBalance:0,navigationHistory:[]},l="Home";function a(e){if("string"!=typeof e||!e.trim())return l;let t=e.split("#")[0].split("?")[0];if(!t||"/"===t||""===t.trim())return l;let r=t.split("/").filter(Boolean);if(0===r.length)return l;let n=(function(e){try{return decodeURIComponent(e)}catch(t){return e}})(r[r.length-1]).replace(/[-_]+/g," ").trim();return n?n.replace(/\b\w/g,e=>e.toUpperCase()):l}function u(e,t){var r,n,s,i,l,u,c,d,h,g,f,p,y,_,m,v,E,S,w,T,I,O,R,D,k,N,A;switch(t.type){case"SET_SLIDES":return{...e,slides:null!==(r=t.slides)&&void 0!==r?r:[]};case"SET_ACTIVE_INDEX":return{...e,activeIndex:Math.max(0,0|t.index)};case"SET_PLAYING":return{...e,playing:!!t.playing};case"SET_WORK_SIZE":return{...e,workSize:{w:0|t.w,h:0|t.h}};case"UPDATE_IMG_STATE":return{...e,imgState:{...e.imgState,...null!==(n=t.patch)&&void 0!==n?n:{}}};case"START_FILE_UPLOAD":{let r=e.fileUpload||o.fileUpload;return{...e,fileUpload:{status:"uploading",progress:0,error:null,lastUpload:null!==(s=null==r?void 0:r.lastUpload)&&void 0!==s?s:null,fileName:null!==(i=t.fileName)&&void 0!==i?i:null}}}case"SET_FILE_UPLOAD_PROGRESS":{let r=e.fileUpload||o.fileUpload,n=Number.isFinite(t.progress)?Math.min(100,Math.max(0,t.progress)):null!==(l=r.progress)&&void 0!==l?l:0;if(r.progress===n&&"uploading"===r.status)return e;return{...e,fileUpload:{...r,progress:n}}}case"COMPLETE_FILE_UPLOAD":{let r=e.fileUpload||o.fileUpload,n=null!==(c=null!==(u=t.fileName)&&void 0!==u?u:r.fileName)&&void 0!==c?c:null;return{...e,fileUpload:{status:"success",progress:100,error:null,lastUpload:{status:"success",fileName:n,result:null!==(d=t.result)&&void 0!==d?d:null},fileName:n}}}case"FAIL_FILE_UPLOAD":{let r=e.fileUpload||o.fileUpload,n=null!==(g=null!==(h=t.fileName)&&void 0!==h?h:r.fileName)&&void 0!==g?g:null,s=null!==(f=t.error)&&void 0!==f?f:null,i=Number.isFinite(t.progress)?Math.min(100,Math.max(0,t.progress)):0;return{...e,fileUpload:{status:"error",progress:i,error:s,lastUpload:{status:"error",fileName:n,error:s},fileName:n}}}case"ADD_TEXT_LAYER":{let r=e.slides.slice(),n=null!==(p=t.index)&&void 0!==p?p:e.activeIndex,s=null!==(y=r[n])&&void 0!==y?y:{image:null,layers:[],workSize:e.workSize,durationMs:3e3},i=(null!==(_=s.layers)&&void 0!==_?_:[]).concat({text:null!==(m=t.text)&&void 0!==m?m:"Text",left:16,top:16,fontSize:24,fontFamily:"system-ui",color:"#ffffff",_fadeInMs:0,_fadeOutMs:0});return r[n]={...s,layers:i},{...e,slides:r}}case"UPDATE_TEXT_LAYER":{let r=e.slides.slice(),n=null!==(v=t.index)&&void 0!==v?v:e.activeIndex,s=r[n];if(!s)return e;let i=s.layers.slice();if(!i[t.layer])return e;return i[t.layer]={...i[t.layer],...null!==(E=t.patch)&&void 0!==E?E:{}},r[n]={...s,layers:i},{...e,slides:r}}case"REMOVE_TEXT_LAYER":{let r=e.slides.slice(),n=null!==(S=t.index)&&void 0!==S?S:e.activeIndex,s=r[n];if(!s)return e;let i=s.layers.filter((e,r)=>r!==t.layer);return r[n]={...s,layers:i},{...e,slides:r}}case"SET_TOKEN_BALANCE":return{...e,tokenBalance:0|t.value};case"SET_USER_ROLE":{let r=("string"==typeof t.role?t.role.trim():"")||o.userRole;if(e.userRole===r)return e;return{...e,userRole:r}}case"PUSH_NAVIGATION_HISTORY":{let r=function(e){if(!e||"string"!=typeof e.href)return null;let t=e.href.trim();if(!t)return null;let r=("string"==typeof e.label?e.label.trim():"")||a(t);return{href:t,label:r}}(t.entry);if(!r)return e;let n=null!==(w=e.navigationHistory)&&void 0!==w?w:[],s=n[n.length-1];if(s&&s.href===r.href){if(s.label===r.label)return e;let t=n.slice();return t[t.length-1]=r,{...e,navigationHistory:t}}return{...e,navigationHistory:n.concat(r)}}case"RESET_NAVIGATION_HISTORY":if(!e.navigationHistory||0===e.navigationHistory.length)return e;return{...e,navigationHistory:[]};case"SET_CURRENT_DESIGN_ID":{let r=e.designOwnership||o.designOwnership,n="string"==typeof t.designId?t.designId:null!=t.designId?String(t.designId):null;if(r.currentDesignId===n&&r===e.designOwnership)return e;return{...e,designOwnership:{...r,ownershipByDesignId:{...r.ownershipByDesignId},currentDesignId:n}}}case"SET_DESIGN_OWNERSHIP_LOADING":{let r=e.designOwnership||o.designOwnership,n=!!t.loading;if(r.loading===n&&r===e.designOwnership)return e;return{...e,designOwnership:{...r,loading:n}}}case"SET_DESIGN_OWNERSHIP_ERROR":{let r=e.designOwnership||o.designOwnership;if(r.error===t.error&&r===e.designOwnership)return e;return{...e,designOwnership:{...r,error:null!==(T=t.error)&&void 0!==T?T:null}}}case"SET_DESIGN_OWNERSHIP_ENTRIES":{let r=e.designOwnership||o.designOwnership,n=r.ownershipByDesignId||{},s=Array.isArray(t.entries)?t.entries:t.entries&&"object"==typeof t.entries?Object.values(t.entries):[],i=!!(null===(I=t.options)||void 0===I?void 0:I.replace),l=(null===(O=t.options)||void 0===O?void 0:O.replace)?{}:{...n};for(let e of s){if(!e)continue;let t=null!==(k=null!==(D=null!==(R=e.id)&&void 0!==R?R:e.designId)&&void 0!==D?D:e.token)&&void 0!==k?k:null;if(null==t)continue;let r="string"==typeof t?t:String(t),s={owned:void 0===e.owned||!!e.owned,...e,id:r};(i||n[r]!==s)&&(i=!0,l[r]=s)}if(!i&&r===e.designOwnership)return e;return{...e,designOwnership:{...r,ownershipByDesignId:l}}}case"CLEAR_DESIGN_OWNERSHIP_ENTRY":{let r=e.designOwnership||o.designOwnership,n=r.ownershipByDesignId||{},s=null!==(A=null!==(N=t.designId)&&void 0!==N?N:t.id)&&void 0!==A?A:null;if(null==s)return e;let i="string"==typeof s?s:String(s);if(!Object.prototype.hasOwnProperty.call(n,i))return e;let l={...n};return delete l[i],{...e,designOwnership:{...r,ownershipByDesignId:l}}}case"RESET_DESIGN_OWNERSHIP":if(e.designOwnership===o.designOwnership)return e;return{...e,designOwnership:{currentDesignId:o.designOwnership.currentDesignId,ownershipByDesignId:{...o.designOwnership.ownershipByDesignId},loading:o.designOwnership.loading,error:o.designOwnership.error}};default:return e}}function c(e){let{children:t}=e,[r,l]=(0,s.useReducer)(u,o),a=(0,s.useMemo)(()=>({...r,setSlides:e=>l({type:"SET_SLIDES",slides:e}),setActiveIndex:e=>l({type:"SET_ACTIVE_INDEX",index:e}),setPlaying:e=>l({type:"SET_PLAYING",playing:e}),setWorkSize:(e,t)=>l({type:"SET_WORK_SIZE",w:e,h:t}),updateImgState:e=>l({type:"UPDATE_IMG_STATE",patch:e}),startFileUpload:e=>{var t;l({type:"START_FILE_UPLOAD",fileName:"string"==typeof e?e:null!==(t=null==e?void 0:e.fileName)&&void 0!==t?t:null})},setFileUploadProgress:e=>l({type:"SET_FILE_UPLOAD_PROGRESS",progress:e}),completeFileUpload:e=>{var t,r;return l({type:"COMPLETE_FILE_UPLOAD",fileName:"string"==typeof e?e:null!==(t=null==e?void 0:e.fileName)&&void 0!==t?t:null,result:"object"==typeof e&&null!==e&&null!==(r=e.result)&&void 0!==r?r:null})},failFileUpload:e=>{var t,r;return l({type:"FAIL_FILE_UPLOAD",fileName:"string"==typeof e?e:null!==(t=null==e?void 0:e.fileName)&&void 0!==t?t:null,error:"object"==typeof e&&null!==e&&null!==(r=e.error)&&void 0!==r?r:null,progress:"object"==typeof e&&null!==e?e.progress:void 0})},addTextLayer:(e,t)=>l({type:"ADD_TEXT_LAYER",text:e,index:t}),updateTextLayer:(e,t,r)=>l({type:"UPDATE_TEXT_LAYER",layer:e,patch:t,index:r}),removeTextLayer:(e,t)=>l({type:"REMOVE_TEXT_LAYER",layer:e,index:t}),setTokenBalance:e=>l({type:"SET_TOKEN_BALANCE",value:e}),setUserRole:e=>l({type:"SET_USER_ROLE",role:e}),resetUserRole:()=>l({type:"SET_USER_ROLE",role:o.userRole}),pushNavigationHistory:e=>l({type:"PUSH_NAVIGATION_HISTORY",entry:e}),resetNavigationHistory:()=>l({type:"RESET_NAVIGATION_HISTORY"}),setCurrentDesignId:e=>l({type:"SET_CURRENT_DESIGN_ID",designId:e}),setDesignOwnershipLoading:e=>l({type:"SET_DESIGN_OWNERSHIP_LOADING",loading:e}),setDesignOwnershipError:e=>l({type:"SET_DESIGN_OWNERSHIP_ERROR",error:e}),setDesignOwnershipEntries:(e,t)=>l({type:"SET_DESIGN_OWNERSHIP_ENTRIES",entries:e,options:t}),clearDesignOwnershipEntry:e=>l({type:"CLEAR_DESIGN_OWNERSHIP_ENTRY",designId:e}),resetDesignOwnership:()=>l({type:"RESET_DESIGN_OWNERSHIP"})}),[r,l]);return(0,n.jsx)(i.Provider,{value:a,children:t})}function d(){let e=(0,s.useContext)(i);if(!e)throw Error("useAppState must be used within an AppStateProvider");return e}},8431:function(e,t,r){"use strict";r.d(t,{Ho:function(){return g},Eu:function(){return f}});var n=r(5893),s=r(7294);let i=[];function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"error",n=arguments.length>3?arguments[3]:void 0;return{level:r,message:e&&e.message?e.message:String(e),stack:e&&e.stack?e.stack:void 0,context:t,details:n,timestamp:new Date().toISOString()}}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0,n=o(e instanceof Error?e:Error(String(e)),t,"error",r);return i.push(n),console.error("[".concat(n.timestamp,"]").concat(t?" "+t+":":""," ").concat(n.message)),n}function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0,n=o(e instanceof Error?e:Error(String(e)),t,"warn",r);return i.push(n),console.warn("[".concat(n.timestamp,"]").concat(t?" "+t+":":""," ").concat(n.message)),n}var u=r(3454);class c{setupInterceptors(){"function"==typeof window.fetch?(this._originalFetch=window.fetch,this._log("API Client initialized with base URL:",this.baseURL)):(this._originalFetch=this.fetch,this._log("API Client initialized without browser environment:",this.baseURL))}_safeParse(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if("string"!=typeof e)return a("".concat(t,": expected string but received ").concat(typeof e)),r;try{return JSON.parse(e)}catch(s){let n=e.slice(0,100);return a(s,"Failed to parse ".concat(t),{snippet:n}),r}}_getSession(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._storage;try{if(!e||"function"!=typeof e.getItem)return null;let t=e.getItem(this._storageKey);if(!t)return null;if("string"!=typeof t||!t.trim().startsWith("{"))return a("Malformed session storage data"),null;let r=this._safeParse(t,"session storage");return r&&"object"==typeof r?r:null}catch(e){return a(e,"Failed to access session storage"),null}}loadToken(){try{let e=this._loadFromStorage("undefined"!=typeof localStorage?localStorage:null,this._persistentDuration);if(e)return this._storage=localStorage,this._currentDuration=this._persistentDuration,this.token=e.token,this._log("Token restored from localStorage"),e.token;let t=this._loadFromStorage("undefined"!=typeof sessionStorage?sessionStorage:null,this._sessionDuration);if(t)return this._storage=sessionStorage,this._currentDuration=this._sessionDuration,this.token=t.token,this._log("Token restored from sessionStorage"),t.token;return this.token=null,this._storage="undefined"!=typeof sessionStorage?sessionStorage:null,this._currentDuration=this._sessionDuration,null}catch(e){return a(e,"Failed to load token from storage"),null}}_loadFromStorage(e,t){if(!e)return null;let r=this._getSession(e);if(r&&"string"==typeof r.token&&"number"==typeof r.lastActivity){if(Date.now()-r.lastActivity<t)return r;try{e.removeItem(this._storageKey)}catch(e){}}return null}_selectStorage(e){e&&"undefined"!=typeof localStorage?(this._storage=localStorage,this._currentDuration=this._persistentDuration):(this._storage="undefined"!=typeof sessionStorage?sessionStorage:null,this._currentDuration=this._sessionDuration)}saveToken(e){try{let t="undefined"!=typeof localStorage?localStorage:null,r="undefined"!=typeof sessionStorage?sessionStorage:null;if(e&&"string"==typeof e&&this._storage){let n={token:e,lastActivity:Date.now()};for(let e of(this._storage.setItem(this._storageKey,JSON.stringify(n)),[t,r].filter(e=>e&&e!==this._storage)))try{e.removeItem(this._storageKey)}catch(e){}this.token=e,this._log("Token saved to storage successfully")}else this.clearToken()}catch(t){a(t,"Failed to save token to storage"),this.token=e}}clearToken(){try{"undefined"!=typeof sessionStorage&&sessionStorage.removeItem(this._storageKey)}catch(e){a(e,"Failed to clear token from sessionStorage")}try{"undefined"!=typeof localStorage&&localStorage.removeItem(this._storageKey)}catch(e){a(e,"Failed to clear token from localStorage")}this.token=null,this._storage="undefined"!=typeof sessionStorage?sessionStorage:null,this._currentDuration=this._sessionDuration}saveUser(e){try{if(e&&"object"==typeof e&&this._storage){let t=this._getSession()||{};t.user=e,t.lastActivity=Date.now(),this._storage.setItem(this._storageKey,JSON.stringify(t))}}catch(e){a(e,"Failed to save user to storage")}}getUser(){try{let e=this._getSession();if(e&&"object"==typeof e.user)return e.user;return e&&a("Session user missing or invalid"),null}catch(e){return a(e,"Failed to get user from storage"),null}}isSessionValid(){try{let e=this._getSession();if(!e||"string"!=typeof e.token||"number"!=typeof e.lastActivity)return e&&a("Session missing required fields"),!1;return Date.now()-e.lastActivity<this._currentDuration}catch(e){return!1}}refreshSession(){try{if(!this.token||!this.isSessionValid()||!this._storage)return;let e=this._getSession();e?(e.lastActivity=Date.now(),this._storage.setItem(this._storageKey,JSON.stringify(e))):a("No valid session to refresh")}catch(e){a(e,"Failed to refresh session")}}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.retryRequest(async()=>{let r="".concat(this.baseURL).concat(e);this.refreshSession();let n={...t.headers||{}},s=Object.keys(n).some(e=>"content-type"===e.toLowerCase()),i="undefined"!=typeof FormData&&t.body instanceof FormData;s||i||(n["Content-Type"]="application/json");let o={headers:n,...t};this.token&&this.isSessionValid()&&!Object.keys(n).some(e=>"authorization"===e.toLowerCase())&&(n.Authorization="Bearer ".concat(this.token)),this._log("Making request:",o.method||"GET",r);try{let t;let n=await this.fetch(r,o);if((n.headers.get("content-type")||"").includes("application/json"))try{t=await n.json()}catch(e){a(e,"Failed to parse JSON response"),t={error:"Invalid server response"}}else t=await n.text();if(!n.ok){if(this._log("Request failed:",n.status,t),401===n.status&&!this.isRetrying&&(this.clearToken(),!e.includes("/auth/")))throw Error("Authentication required - please log in again");if(429===n.status)throw Error("Too many requests - please wait a moment");if(n.status>=500)throw Error("Server error - please try again later");let r="object"==typeof t?t.error:t;throw Error(r||"HTTP ".concat(n.status,": ").concat(n.statusText))}return this._log("Request successful:",t),t}catch(e){if("TypeError"===e.name&&e.message.includes("fetch"))throw Error("Network error - please check your connection");throw e}})}async get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new URLSearchParams(t).toString(),n=r?"".concat(e,"?").concat(r):e;return this.request(n,{method:"GET"})}async post(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request(e,{method:"POST",body:JSON.stringify(t),...r})}async put(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request(e,{method:"PUT",body:JSON.stringify(t)})}async delete(e){return this.request(e,{method:"DELETE"})}async getUserTokens(){return this.get("/user/tokens")}async updateTokens(e){return this.post("/purchase",{tokens:e})}async listMarketplace(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={},{role:r,category:n,search:s,ownerId:i,mine:o}=e||{};if("string"==typeof r&&r.trim()&&(t.role=r.trim().toLowerCase()),"string"==typeof n&&n.trim()&&(t.category=n.trim()),"string"==typeof s&&s.trim()&&(t.search=s.trim()),null!=i){let e=String(i).trim();e&&(t.ownerId=e)}return("string"==typeof o?["1","true","yes","y"].includes(o.trim().toLowerCase()):!!o)&&(t.mine="true"),this.get("/api/marketplace",t)}async register(e){this.isRetrying=!0;try{let t=await this.post("/auth/register",e);return t.token&&this.saveToken(t.token),t.user&&this.saveUser(t.user),t}finally{this.isRetrying=!1}}async login(e){let{remember:t=!1,...r}=e;try{let e=await this.request("/auth/login",{method:"POST",body:JSON.stringify(r)});if(e.access_token||e.token){let r=e.access_token||e.token;return this._selectStorage(t),this.saveToken(r),e.user&&this.saveUser(e.user),e}throw Error("No token received from server")}catch(e){throw l(e,"Login failed"),e}}async logout(){try{if(this.isAuthenticated())try{await this.request("/auth/logout",{method:"POST"})}catch(e){a(e,"Logout endpoint failed")}}finally{this.clearToken()}}async getCurrentUser(){let e=this.getUser();if(e&&this.isSessionValid())return{user:e};let t=await this.get("/auth/me");return t.user&&this.saveUser(t.user),t}async getUserDesigns(){return this.get("/designs")}async getProjects(){return this.get("/projects")}async getProject(e){return this.get("/projects/".concat(e))}async saveProject(e){return this.post("/projects",e)}async updateProject(e,t){return this.put("/projects/".concat(e),t)}async deleteProject(e){return this.delete("/projects/".concat(e))}async uploadImage(e){if(!e)throw Error("No file provided");if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(e.type))throw Error("Invalid file type. Please upload JPEG, PNG, GIF, or WebP images.");if(e.size>10485760)throw Error("File is too large. Maximum size is 10MB.");if(!this.token||!this.isSessionValid())throw Error("Authentication required for image upload");let t=new FormData;t.append("image",e);try{return await this.request("/images/upload",{method:"POST",body:t})}catch(e){throw Error("Image upload failed: ".concat(e.message))}}async loadCustomerDesign(e){return this.get("/editor/".concat(e))}async saveCustomerDesign(e,t){return this.post("/editor/".concat(e,"/save"),t)}async getCustomerRSVPs(e){return this.get("/editor/".concat(e,"/rsvps"))}async submitRSVP(e){return this.post("/rsvp/submit",e)}isAuthenticated(){return!!(this.token&&this.isSessionValid())}handleError(e){l(e,"API Error");let t=e.message||"An unexpected error occurred.";return t.includes("Network error")?"Connection failed. Please check your internet connection.":t.includes("Authentication required")?"Please log in to continue.":t.includes("Invalid credentials")?"Invalid email or password.":t.includes("User already exists")?"An account with this email already exists.":t.includes("Too many requests")?"Too many requests. Please wait a moment before trying again.":t.includes("File is too large")?"File is too large. Maximum size is 10MB.":t.includes("Invalid file type")?"Please upload a valid image file (JPEG, PNG, GIF, or WebP).":t.includes("Server error")?"Server temporarily unavailable. Please try again later.":t}async retryRequest(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;for(let s=0;s<r;s++)try{return await e()}catch(i){t=i;let e=i.message||"";if(e.includes("Authentication")||e.includes("Invalid")||e.includes("Too many requests")||e.includes("unauthorized"))throw i;if(s<r-1){let e=n*Math.pow(2,s);await new Promise(t=>setTimeout(t,e))}}throw t}async uploadImages(e){let t=Array.from(e).map(e=>this.uploadImage(e));try{return await Promise.all(t)}catch(e){throw Error("Failed to upload images: ".concat(e.message))}}setBaseURL(e){this.baseURL=e,this._log("Base URL updated to:",e)}getBaseURL(){return this.baseURL}async healthCheck(){let e=new AbortController,t=setTimeout(()=>e.abort(),5e3);try{let r=await this.request("/health",{signal:e.signal});return clearTimeout(t),r}catch(e){if(clearTimeout(t),"AbortError"===e.name)throw Error("Health check timed out");throw Error("Backend server is not responding")}}debug(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];this._debug=e,e&&(console.log("API Client Debug Mode Enabled"),console.log("Base URL:",this.baseURL),console.log("Token:",this.token?"Present":"Not set"),console.log("Session Valid:",this.isSessionValid()))}_log(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];this._debug&&console.log("[API Client]",...t)}constructor(e,t){let r=void 0!==u&&u.env&&u.env.NEXT_PUBLIC_API_BASE_URL?u.env.NEXT_PUBLIC_API_BASE_URL:null;if(!e){if(r)e=r;else{let t=window.location.hostname;e="localhost"===t||"127.0.0.1"===t?"http://localhost:3001":"https://invitation-maker-api.celesia91.workers.dev/api"}}"function"==typeof window.fetch?this.fetch=window.fetch.bind(window):this.fetch=t||("undefined"!=typeof globalThis&&"function"==typeof globalThis.fetch?globalThis.fetch.bind(globalThis):void 0),this.baseURL=e,this._storageKey="app_auth_session",this._sessionDuration=864e5,this._persistentDuration=6048e5,this._storage="undefined"!=typeof sessionStorage?sessionStorage:null,this._currentDuration=this._sessionDuration,this.token=this.loadToken(),this.setupInterceptors(),this.isRetrying=!1,this._debug=!1}}new c;var d=r(6177);let h=(0,s.createContext)(null);function g(e){let{children:t,apiClient:r=null}=e,i=(0,s.useMemo)(()=>null!=r?r:new c,[r]),[o,l]=(0,s.useState)(null),[a,u]=(0,s.useState)(!1),[g,f]=(0,s.useState)(null),[p,y]=(0,s.useState)(!1),[_,m]=(0,s.useState)(!1),v=(0,s.useRef)(!1),{setUserRole:E,resetUserRole:S,resetDesignOwnership:w,setCurrentDesignId:T}=(0,d.mr)(),I=(0,s.useCallback)(e=>{let t="string"==typeof(null==e?void 0:e.role)?e.role:null;t&&t.trim()?E(t):S()},[S,E]),O=(0,s.useCallback)(()=>{try{return!!i.isAuthenticated()}catch(e){return!1}},[i]),R=(0,s.useCallback)(async e=>{let{email:t,password:r,remember:n=!1}=e;u(!0),f(null);try{let e=await i.login({email:t,password:r,remember:n});(null==e?void 0:e.user)&&(l(e.user),I(e.user));let s=O();return y(s),(null==e?void 0:e.user)&&s||(S(),w(),T(null)),e}catch(e){throw f(e),y(O()),e}finally{u(!1)}},[i,I,O,w,S,T]),D=(0,s.useCallback)(async()=>{u(!0),f(null);try{await i.logout(),y(O()),l(null),S(),w(),T(null)}catch(e){f(e),l(null),S(),w(),T(null),y(O())}finally{u(!1)}},[i,O,w,S,T]),k=(0,s.useCallback)(async()=>{u(!0),f(null);try{var e;let t=await i.getCurrentUser();(null==t?void 0:t.user)&&(l(t.user),I(t.user));let r=O();return y(r),(null==t?void 0:t.user)&&r||(S(),w(),T(null)),null!==(e=null==t?void 0:t.user)&&void 0!==e?e:null}catch(e){return f(e),S(),w(),T(null),y(O()),null}finally{u(!1)}},[i,I,O,w,S,T]);(0,s.useEffect)(()=>{let e=!1,t=()=>{v.current||(v.current=!0,k().finally(()=>{v.current=!1}))},r=()=>{l(null),S()};try{if(O()){y(!0);try{let e=i.getUser();e?(l(e),I(e)):o||(r(),t())}catch(e){o||(r(),t())}}else e=!0,y(!1)}catch(t){e=!0,y(!1)}e&&(r(),w(),T(null),v.current=!1),m(!0)},[i,I,O,k,w,S,T,o]);let N=(0,s.useMemo)(()=>({user:o,loading:a,error:g,isAuthenticated:p,isInitialized:_,login:R,logout:D,refreshUser:k,api:i}),[o,a,g,p,_,R,D,k,i]);return(0,n.jsx)(h.Provider,{value:N,children:t})}function f(){let e=(0,s.useContext)(h);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},3414:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var n=r(5893),s=r(7294),i=r(1163),o=r(6177),l=r(8431);function a(){let e=(0,i.useRouter)(),{pushNavigationHistory:t,resetNavigationHistory:r}=(0,o.mr)(),n=(0,s.useRef)(t),l=(0,s.useRef)(r);return(0,s.useEffect)(()=>{n.current=t},[t]),(0,s.useEffect)(()=>{l.current=r},[r]),(0,s.useEffect)(()=>{if(!e||!e.events)return;let t=e.asPath||e.pathname||"/";l.current(),n.current({href:t,label:(0,o.qD)(t)});let r=e=>{n.current({href:e,label:(0,o.qD)(e)})};return e.events.on("routeChangeComplete",r),()=>{e.events.off("routeChangeComplete",r),l.current()}},[e]),null}function u(e){let{Component:t,pageProps:r}=e;return(0,n.jsx)(o.WE,{children:(0,n.jsxs)(l.Ho,{children:[(0,n.jsx)(a,{}),(0,n.jsx)(t,{...r})]})})}r(3434),r(981)},3434:function(){},981:function(){},7663:function(e){!function(){var t={229:function(e){var t,r,n,s=e.exports={};function i(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function l(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var a=[],u=!1,c=-1;function d(){u&&n&&(u=!1,n.length?a=n.concat(a):c=-1,a.length&&h())}function h(){if(!u){var e=l(d);u=!0;for(var t=a.length;t;){for(n=a,a=[];++c<t;)n&&n[c].run();c=-1,t=a.length}n=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function f(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];a.push(new g(e,t)),1!==a.length||u||l(h)},g.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=f,s.addListener=f,s.once=f,s.off=f,s.removeListener=f,s.removeAllListeners=f,s.emit=f,s.prependListener=f,s.prependOnceListener=f,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},r={};function n(e){var s=r[e];if(void 0!==s)return s.exports;var i=r[e]={exports:{}},o=!0;try{t[e](i,i.exports,n),o=!1}finally{o&&delete r[e]}return i.exports}n.ab="//";var s=n(229);e.exports=s}()},1163:function(e,t,r){e.exports=r(3079)}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[774,179],function(){return t(3837),t(3079)}),_N_E=e.O()}]);